{"version":3,"file":"index.js","sources":["../src/mana.ts","../src/index.ts"],"sourcesContent":["import * as eth from 'eth-connect'\nimport * as dclTx from 'decentraland-transactions'\n\nconst defaultServerURL = 'https://transactions-api.decentraland.org/v1'\n\nexport type Providers = {\n  requestManager: eth.RequestManager\n  metaRequestManager: eth.RequestManager\n  fromAddress: string\n}\n\nexport type Options = {\n  serverURL: string\n}\n\nexport interface IMANAComponents {\n  balance: (from?: string) => Promise<string>\n  allowance: (spenderAddress: string, from?: string) => Promise<string>\n  approve: (spenderAddress: string, amount?: eth.BigNumber, options?: Options) => Promise<string>\n  transfer: (to: string, amount: eth.BigNumber, options?: Options) => Promise<string>\n  //depositMana: (amount: number) => Promise<string>\n}\n\nexport function createMANAComponent({\n  requestManager,\n  metaRequestManager,\n  fromAddress,\n}: Providers): IMANAComponents {\n  async function getContract() {\n    const manaConfig = dclTx.getContract(dclTx.ContractName.MANAToken, 137)\n    let contract: any = await new eth.ContractFactory(metaRequestManager, manaConfig.abi).at(\n      manaConfig.address\n    )\n\n    return {\n      manaConfig,\n      contract,\n    }\n  }\n\n  async function balance(from?: string) {\n    const { manaConfig, contract } = await getContract()\n    const res = await contract.balanceOf(from || fromAddress)\n\n    return res\n  }\n\n  async function allowance(spenderAddress: string, from?: string) {\n    const { manaConfig, contract } = await getContract()\n    const res = await contract.allowance(from || fromAddress, spenderAddress)\n\n    return res\n  }\n\n  async function approve(spenderAddress: string, amount?: eth.BigNumber, options?: Options) {\n    const { manaConfig, contract } = await getContract()\n\n    options = options || { serverURL: defaultServerURL }\n    options.serverURL = options.serverURL || defaultServerURL\n\n    const functionHex = contract.approve.toPayload(\n      spenderAddress,\n      amount || '0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff'\n    )\n\n    const txHash = await dclTx.sendMetaTransaction(\n      requestManager as any,\n      metaRequestManager as any,\n      functionHex.data,\n      manaConfig,\n      { serverURL: options.serverURL }\n    )\n    return txHash\n  }\n  async function transfer(to: string, amount: eth.BigNumber, options?: Options) {\n    const { manaConfig, contract } = await getContract()\n\n    options = options || { serverURL: defaultServerURL }\n    options.serverURL = options.serverURL || defaultServerURL\n\n    const functionHex = contract.transfer.toPayload(to, amount)\n\n    const txHash = await dclTx.sendMetaTransaction(\n      requestManager as any,\n      metaRequestManager as any,\n      functionHex.data,\n      manaConfig,\n      { serverURL: options.serverURL }\n    )\n    return txHash\n  }\n  return { transfer, balance, allowance, approve }\n}\n","import { getUserAccount } from '@decentraland/EthereumController'\nimport { getProvider } from '@decentraland/web3-provider'\nimport * as eth from 'eth-connect'\nimport { createMANAComponent } from './mana'\n\nexport async function createComponents() {\n    const provider = await getProvider()\n    const requestManager: any = new eth.RequestManager(provider)\n    const metaProvider: any = new eth.HTTPProvider('https://polygon-rpc.com')\n    const fromAddress = await getUserAccount()\n    const metaRequestManager: any = new eth.RequestManager(metaProvider)\n    const providers = {\n      requestManager,\n      metaProvider,\n      metaRequestManager,\n      fromAddress,\n    }\n\n    const mana = await createMANAComponent(providers)\n\n    return { mana } \n}\n"],"names":["dclTx","eth","getProvider","getUserAccount"],"mappings":"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"}